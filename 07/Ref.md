ruby TCPServer å®ä¾‹å¯ä»¥è°ƒç”¨read, gets ç­‰æ–¹å¼æ˜¯å†å“ªé‡Œè°ƒç”¨çš„



###### ChatGPT è¯´ï¼š

`TCPServer` ç»§æ‰¿è‡ª `BasicSocket`ï¼Œè€Œ `BasicSocket` åˆç»§æ‰¿è‡ª `IO`ï¼Œæ‰€ä»¥ `TCPServer` å¯ä»¥è°ƒç”¨ `read`ã€`gets` ç­‰æ–¹æ³•æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•åœ¨ `IO` åŠå…¶ç¥–å…ˆç±»ä¸­å®šä¹‰äº†ã€‚

ä½†å…³é”®ç‚¹æ˜¯ `TCPServer` æœ¬èº«ä¸»è¦ç”¨äºç›‘å¬å’Œæ¥å—è¿æ¥ï¼Œè€Œ `read` å’Œ `gets` è¿™äº›æ–¹æ³•é€šå¸¸ç”¨äº**å·²å»ºç«‹çš„è¿æ¥**ï¼Œå³ `TCPSocket`ã€‚å½“ `TCPServer#accept` è¿”å›ä¸€ä¸ª `TCPSocket` å®ä¾‹æ—¶ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ª `TCPSocket` å®ä¾‹ä¸Šè°ƒç”¨ `read` æˆ– `gets`ã€‚

### å…·ä½“ç»§æ‰¿å…³ç³»ï¼š

```
ruby


å¤åˆ¶ç¼–è¾‘
TCPServer < IPSocket < BasicSocket < IO
```

å¯ä»¥çœ‹åˆ° `TCPServer` ç»§æ‰¿äº† `IO`ï¼Œå› æ­¤å®ƒå¯ä»¥ä½¿ç”¨ `read`ã€`gets` ç­‰æ–¹æ³•ã€‚

------

## å…·ä½“è°ƒç”¨æµç¨‹ï¼š

1. `TCPServer#accept` è¿”å›ä¸€ä¸ª `TCPSocket` å®ä¾‹ã€‚
2. `TCPSocket` ç»§æ‰¿è‡ª `BasicSocket`ï¼Œæœ€ç»ˆä¹Ÿç»§æ‰¿äº† `IO`ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨ `read`ã€`gets` è¿™äº›æ–¹æ³•ã€‚

### ç¤ºä¾‹ä»£ç ï¼š

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

server = TCPServer.new(1234)  # ç›‘å¬ 1234 ç«¯å£
socket = server.accept        # æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›ä¸€ä¸ª TCPSocket å®ä¾‹
puts socket.gets              # è¯»å–ä¸€è¡Œæ•°æ®
socket.close
server.close
```

**è§£æ**ï¼š

- `server.accept` è¿”å›çš„ `socket` æ˜¯ä¸€ä¸ª `TCPSocket` å®ä¾‹ã€‚
- `TCPSocket` ç»§æ‰¿äº† `IO`ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è°ƒç”¨ `gets`ã€`read` ç­‰æ–¹æ³•æ¥è¯»å–æ•°æ®ã€‚

å› æ­¤ï¼Œ`read` å’Œ `gets` å®é™…ä¸Šæ˜¯åœ¨ `TCPSocket` ä¸Šè°ƒç”¨çš„ï¼Œè€Œ `TCPServer` åªæ˜¯è´Ÿè´£ç›‘å¬è¿æ¥ã€‚

##### æ‚¨è¯´ï¼š

3.2.	TCPæ•°æ®é€šä¿¡ TCPé€šä¿¡ä¸»è¦ç”¨äºè®¾å¤‡ä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå‘½ä»¤äº¤äº’ã€‚ä¼ è¾“æ•°æ®éœ€è¦è¿›è¡ŒåŠ å¯†ï¼Œå¦‚ä¸‹æ˜¯å‘é€æ•´ä¸ªæ•°æ®åŒ…çš„æ ¼å¼ï¼š æ•°æ®æµé•¿åº¦(int,4å­—èŠ‚)|æ•°æ®åŒ…(åŠ å¯†åŒº) åŒ…å¤´ç”¨å‰4ä¸ªå­—èŠ‚è¡¨ç¤ºæ•°æ®åŒ…é•¿åº¦ï¼ŒåŒ…ä½“æ˜¯æ•°æ®åŒ…ä¸»ä½“ä¸ºåŠ å¯†åŒºåŸŸ



###### ChatGPT è¯´ï¼š

å¦‚æœè¦åœ¨ Ruby ä¸­å®ç°ç¬¦åˆè¯¥åè®®çš„ TCP é€šä¿¡ï¼ˆå¸¦æœ‰ 4 å­—èŠ‚æ•°æ®é•¿åº¦çš„åŒ…å¤´ + åŠ å¯†æ•°æ®åŒ…ï¼‰ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š

------

## **å‘é€ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰**

1. **åŠ å¯†æ•°æ®åŒ…**ï¼ˆå¯ä»¥ä½¿ç”¨ AES æˆ–å…¶ä»–å¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ã€‚
2. **è®¡ç®—æ•°æ®åŒ…é•¿åº¦**ï¼ˆä»¥ 4 å­—èŠ‚æ•´æ•°è¡¨ç¤ºï¼‰ã€‚
3. **å‘é€æ•°æ®åŒ…**ï¼ˆå…ˆå‘é€ 4 å­—èŠ‚çš„é•¿åº¦ï¼Œå†å‘é€åŠ å¯†æ•°æ®ï¼‰ã€‚

------

## **æ¥æ”¶ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰**

1. **å…ˆè¯»å– 4 å­—èŠ‚çš„åŒ…å¤´**ï¼Œè§£æå‡ºæ•°æ®åŒ…é•¿åº¦ã€‚
2. **å†è¯»å–æ•°æ®åŒ…å†…å®¹**ï¼ˆè§£å¯†åå¤„ç†ï¼‰ã€‚

------

### **Ruby ç¤ºä¾‹**

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ **TCP å®¢æˆ·ç«¯-æœåŠ¡å™¨** ç¤ºä¾‹ï¼Œå…¶ä¸­ï¼š

- ä½¿ç”¨ AES-256-CBC è¿›è¡ŒåŠ å¯†
- é‡‡ç”¨ `pack("N")` ç¼–ç  4 å­—èŠ‚é•¿åº¦
- æœåŠ¡å™¨æ¥æ”¶åè§£å¯†å¹¶å¤„ç†

------

### **1ï¸âƒ£ å®¢æˆ·ç«¯**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'openssl'

KEY  = "1234567890abcdef1234567890abcdef" # 32å­—èŠ‚å¯†é’¥
IV   = "abcdef1234567890"                 # 16å­—èŠ‚ IV

def encrypt_data(data)
  cipher = OpenSSL::Cipher.new("AES-256-CBC")
  cipher.encrypt
  cipher.key = KEY
  cipher.iv  = IV
  encrypted = cipher.update(data) + cipher.final
  return encrypted
end

socket = TCPSocket.new("127.0.0.1", 1234)

data = "Hello, Server!"
encrypted_data = encrypt_data(data)

# è®¡ç®—æ•°æ®åŒ…é•¿åº¦å¹¶æ‰“åŒ…ä¸º 4 å­—èŠ‚ï¼ˆå¤§ç«¯æ¨¡å¼ï¼‰
packet = [encrypted_data.bytesize].pack("N") + encrypted_data

socket.write(packet)
socket.close
```

------

### **2ï¸âƒ£ æœåŠ¡å™¨**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'openssl'

KEY  = "1234567890abcdef1234567890abcdef"
IV   = "abcdef1234567890"

def decrypt_data(data)
  decipher = OpenSSL::Cipher.new("AES-256-CBC")
  decipher.decrypt
  decipher.key = KEY
  decipher.iv  = IV
  decrypted = decipher.update(data) + decipher.final
  return decrypted
end

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å– 4 å­—èŠ‚çš„åŒ…å¤´ï¼Œè·å–æ•°æ®é•¿åº¦
  header = client.read(4)
  data_length = header.unpack1("N") # è§£åŒ… 4 å­—èŠ‚çš„é•¿åº¦

  # è¯»å–æ•°æ®åŒ…
  encrypted_data = client.read(data_length)

  # è§£å¯†æ•°æ®
  decrypted_data = decrypt_data(encrypted_data)

  puts "Received: #{decrypted_data}"

  client.close
end
```

------

## **è¿è¡Œæ–¹å¼**

1. å…ˆè¿è¡ŒæœåŠ¡å™¨

   ```
   sh
   
   
   å¤åˆ¶ç¼–è¾‘
   ruby server.rb
   ```

2. å†è¿è¡Œå®¢æˆ·ç«¯

   ```
   sh
   
   
   å¤åˆ¶ç¼–è¾‘
   ruby client.rb
   ```

æœåŠ¡å™¨ç«¯åº”è¯¥èƒ½æ­£ç¡®æ¥æ”¶åˆ° `"Hello, Server!"` è¿™æ¡è§£å¯†åçš„æ¶ˆæ¯ã€‚

------

## **è§£æ**

1. **æ•°æ®æ ¼å¼**
   - `æ•°æ®æµé•¿åº¦(4å­—èŠ‚) | æ•°æ®åŒ…(åŠ å¯†åŒº)`
   - é€šè¿‡ `pack("N")` ç¼–ç æ•°æ®é•¿åº¦ï¼ˆå¤§ç«¯åºï¼‰
   - `read(4)` è¯»å–åŒ…å¤´ï¼Œ`read(data_length)` è¯»å–åŠ å¯†æ•°æ®åŒ…
2. **åŠ å¯†æ–¹å¼**
   - ä½¿ç”¨ **AES-256-CBC**ï¼ˆå¯æ›´æ¢å…¶ä»–åŠ å¯†æ–¹å¼ï¼‰
   - éœ€è¦ **å¯†é’¥ (`KEY`) å’Œ IV (`IV`)** ä¸€è‡´ï¼Œå¦åˆ™è§£å¯†å¤±è´¥
3. **é€‚ç”¨åœºæ™¯**
   - è®¾å¤‡ä¸æœåŠ¡å™¨å®‰å…¨é€šä¿¡
   - éœ€è¦åŠ å¯†ä¿æŠ¤çš„æ•°æ®ä¼ è¾“

è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ **TCP é•¿åº¦åŒ…å¤´ + åŠ å¯†æ•°æ®é€šä¿¡åè®®** ğŸš€ã€‚

##### æ‚¨è¯´ï¼š

pack unpack è§£é‡Šä¸€ä¸‹å¦‚ä½•ä½¿ç”¨



###### ChatGPT è¯´ï¼š

`pack` å’Œ `unpack` æ˜¯ Ruby ä¸­ç”¨äº**äºŒè¿›åˆ¶æ•°æ®å¤„ç†**çš„æ–¹æ³•ï¼Œä¸»è¦ç”¨äº **å°†æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼** æˆ– **ä»äºŒè¿›åˆ¶æ ¼å¼è§£ææ•°æ®**ã€‚å®ƒä»¬åœ¨ç½‘ç»œé€šä¿¡ã€æ–‡ä»¶å¤„ç†ã€åŠ å¯†è§£å¯†ç­‰åœºæ™¯ä¸­éå¸¸å¸¸è§ã€‚

------

# **1. `pack` ç”¨äºç¼–ç æ•°æ®**

`pack` æ–¹æ³•ç”¨äº**å°† Ruby æ•°ç»„è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²**ï¼Œå¯ä»¥å°†æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç­‰è½¬æ¢ä¸ºç‰¹å®šçš„å­—èŠ‚æ ¼å¼ã€‚

### **å¸¸è§çš„ `pack` æ ¼å¼**

| æ ¼å¼ç¬¦  | è¯´æ˜                      | ç¤ºä¾‹                                                      |
| ------- | ------------------------- | --------------------------------------------------------- |
| `"C"`   | 8-bit æ— ç¬¦å·æ•´æ•° (1 å­—èŠ‚) | `[255].pack("C")` â†’ `"\xFF"`                              |
| `"n"`   | 16-bit æ— ç¬¦å·æ•´æ•° (å¤§ç«¯)  | `[1024].pack("n")` â†’ `"\x04\x00"`                         |
| `"N"`   | 32-bit æ— ç¬¦å·æ•´æ•° (å¤§ç«¯)  | `[1024].pack("N")` â†’ `"\x00\x00\x04\x00"`                 |
| `"V"`   | 32-bit æ— ç¬¦å·æ•´æ•° (å°ç«¯)  | `[1024].pack("V")` â†’ `"\x00\x04\x00\x00"`                 |
| `"Q>"`  | 64-bit æ— ç¬¦å·æ•´æ•° (å¤§ç«¯)  | `[123456].pack("Q>")` â†’ `"\x00\x00\x00\x00\x00\x01\xe2@"` |
| `"a*" ` | å­—ç¬¦ä¸² (ä¸å®šé•¿)           | `["hello"].pack("a*")` â†’ `"hello"`                        |
| `"A*" ` | å­—ç¬¦ä¸² (ç©ºæ ¼å¡«å……)         | `["hello"].pack("A*")` â†’ `"hello    "`                    |

------

## **ç¤ºä¾‹ï¼šå°†æ•´æ•°è½¬æ¢ä¸º 4 å­—èŠ‚å¤§ç«¯æ ¼å¼**

```
ruby


å¤åˆ¶ç¼–è¾‘
data = [1024].pack("N")  # 1024 åœ¨ 4 å­—èŠ‚å¤§ç«¯åºåˆ—è¡¨ç¤ºä¸º "\x00\x00\x04\x00"
puts data.bytes.inspect  # => [0, 0, 4, 0]
```

------

# **2. `unpack` ç”¨äºè§£ç æ•°æ®**

`unpack` æ–¹æ³•ç”¨äº**å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢å› Ruby æ•°ç»„**ï¼Œç”¨äºè§£æç½‘ç»œæ•°æ®ã€æ–‡ä»¶å¤´ç­‰ã€‚

### **å¸¸è§çš„ `unpack` æ ¼å¼**

| æ ¼å¼ç¬¦ | è¯´æ˜                      | ç¤ºä¾‹                                                        |
| ------ | ------------------------- | ----------------------------------------------------------- |
| `"C"`  | 8-bit æ— ç¬¦å·æ•´æ•° (1 å­—èŠ‚) | `"\xFF".unpack("C")` â†’ `[255]`                              |
| `"n"`  | 16-bit æ— ç¬¦å·æ•´æ•° (å¤§ç«¯)  | `"\x04\x00".unpack("n")` â†’ `[1024]`                         |
| `"N"`  | 32-bit æ— ç¬¦å·æ•´æ•° (å¤§ç«¯)  | `"\x00\x00\x04\x00".unpack("N")` â†’ `[1024]`                 |
| `"V"`  | 32-bit æ— ç¬¦å·æ•´æ•° (å°ç«¯)  | `"\x00\x04\x00\x00".unpack("V")` â†’ `[1024]`                 |
| `"Q>"` | 64-bit æ— ç¬¦å·æ•´æ•° (å¤§ç«¯)  | `"\x00\x00\x00\x00\x00\x01\xe2@".unpack("Q>")` â†’ `[123456]` |
| `"a*"` | è§£æå­—ç¬¦ä¸² (ä¸å®šé•¿)       | `"hello".unpack("a*")` â†’ `["hello"]`                        |

------

## **ç¤ºä¾‹ï¼šè§£æ 4 å­—èŠ‚å¤§ç«¯æ ¼å¼**

```
ruby


å¤åˆ¶ç¼–è¾‘
data = "\x00\x00\x04\x00"
length = data.unpack("N")[0]  # è§£æä¸º 1024
puts length  # => 1024
```

------

# **3. `pack` å’Œ `unpack` ç»“åˆä½¿ç”¨**

## **ç¤ºä¾‹ï¼šå‘é€å’Œæ¥æ”¶ 32-bit å¤§ç«¯åºæ•´æ•°**

```
ruby


å¤åˆ¶ç¼–è¾‘
# å‘é€æ–¹ (ç¼–ç æ•°æ®)
packet = [2048].pack("N")  # 2048 -> "\x00\x00\x08\x00"
puts packet.bytes.inspect  # => [0, 0, 8, 0]

# æ¥æ”¶æ–¹ (è§£ç æ•°æ®)
length = packet.unpack("N")[0]
puts length  # => 2048
```

------

# **4. ç½‘ç»œä¼ è¾“ä¸­çš„åº”ç”¨**

## **ç¤ºä¾‹ï¼šTCP å‘é€ 4 å­—èŠ‚é•¿åº¦çš„åŒ…å¤´**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

server = TCPServer.new(1234)

Thread.new do
  client = server.accept
  header = client.read(4)         # è¯»å– 4 å­—èŠ‚çš„åŒ…å¤´
  data_length = header.unpack("N")[0] # è§£ææ•°æ®é•¿åº¦
  data = client.read(data_length) # è¯»å–æ•°æ®åŒ…
  puts "Received: #{data}"
  client.close
end

sleep(1)

client = TCPSocket.new("127.0.0.1", 1234)
message = "Hello, world!"
packet = [message.bytesize].pack("N") + message
client.write(packet)
client.close
```

------

# **5. å°ç«¯ (Little-endian) å’Œ å¤§ç«¯ (Big-endian)**

åœ¨ `pack` å’Œ `unpack` æ—¶ï¼Œæ•´æ•°å¯ä»¥æœ‰ **å¤§ç«¯ (Big-endian) å’Œ å°ç«¯ (Little-endian) ä¸¤ç§è¡¨ç¤º**ï¼š

- **å¤§ç«¯ (Big-endian)** (`"N"`, `"n"`, `"Q>"`)ï¼šé«˜ä½å­—èŠ‚åœ¨å‰ï¼Œé€‚ç”¨äºç½‘ç»œåè®®
- **å°ç«¯ (Little-endian)** (`"V"`, `"v"`, `"Q<"`)ï¼šä½ä½å­—èŠ‚åœ¨å‰ï¼Œé€‚ç”¨äº x86 å¤„ç†å™¨

### **ç¤ºä¾‹**

```
ruby


å¤åˆ¶ç¼–è¾‘
num = 1024

big_endian = [num].pack("N")  # "\x00\x00\x04\x00"
puts big_endian.bytes.inspect # => [0, 0, 4, 0]

little_endian = [num].pack("V")  # "\x00\x04\x00\x00"
puts little_endian.bytes.inspect # => [0, 4, 0, 0]
```

------

# **æ€»ç»“**

- **`pack`**: **æ•°ç»„ â†’ äºŒè¿›åˆ¶å­—ç¬¦ä¸²**
- **`unpack`**: **äºŒè¿›åˆ¶å­—ç¬¦ä¸² â†’ æ•°ç»„**
- **ç½‘ç»œé€šä¿¡ä½¿ç”¨** **å¤§ç«¯ (Big-endian, `"N"`)**
- å¸¸è§æ•°æ®æ ¼å¼
  - `N` - 32-bit å¤§ç«¯æ•´æ•°
  - `V` - 32-bit å°ç«¯æ•´æ•°
  - `n` - 16-bit å¤§ç«¯æ•´æ•°
  - `v` - 16-bit å°ç«¯æ•´æ•°
  - `C` - 8-bit æ— ç¬¦å·æ•´æ•°
  - `a*` - ä¸å®šé•¿å­—ç¬¦ä¸²

è¿™äº›æ–¹æ³•åœ¨ **ç½‘ç»œç¼–ç¨‹ã€æ–‡ä»¶æ ¼å¼è§£æã€æ•°æ®åŠ å¯†** ç­‰åœºæ™¯ä¸‹éƒ½éå¸¸æœ‰ç”¨ ğŸš€ã€‚

##### æ‚¨è¯´ï¼š

ç”¨äºŒè¿›åˆ¶ç°å®



###### ChatGPT è¯´ï¼š

å¦‚æœä½ æƒ³ç”¨**äºŒè¿›åˆ¶æ ¼å¼**å±•ç¤º `pack` å’Œ `unpack` çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `unpack("B*")` æ¥è½¬æ¢æˆäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `to_i(2).to_s(2).rjust(8, '0')` æ¥ç¡®ä¿äºŒè¿›åˆ¶æ ¼å¼æ­£ç¡®ã€‚

------

## **ç¤ºä¾‹ï¼š32-bit å¤§ç«¯ (Big-endian)**

```
ruby


å¤åˆ¶ç¼–è¾‘
num = 1024
binary_packed = [num].pack("N")  # 4 å­—èŠ‚å¤§ç«¯å­˜å‚¨
puts binary_packed.unpack("B*")  # => ["00000000000000000000010000000000"]
```

### **è§£æ**

1. **`1024` çš„äºŒè¿›åˆ¶** æ˜¯ `00000000 00000000 00000100 00000000`
2. **`pack("N")` é‡‡ç”¨å¤§ç«¯å­˜å‚¨**ï¼Œæ‰€ä»¥é«˜ä½åœ¨å‰
3. **ç»“æœï¼š`00000000 00000000 00000100 00000000`**

------

## **ç¤ºä¾‹ï¼š32-bit å°ç«¯ (Little-endian)**

```
ruby


å¤åˆ¶ç¼–è¾‘
num = 1024
binary_packed = [num].pack("V")  # 4 å­—èŠ‚å°ç«¯å­˜å‚¨
puts binary_packed.unpack("B*")  # => ["00000000000001000000000000000000"]
```

### **è§£æ**

1. **`1024` çš„äºŒè¿›åˆ¶** ä»ç„¶æ˜¯ `00000000 00000000 00000100 00000000`
2. **`pack("V")` é‡‡ç”¨å°ç«¯å­˜å‚¨**ï¼Œæ‰€ä»¥ä½ä½åœ¨å‰
3. **ç»“æœï¼š`00000000 00000100 00000000 00000000`**

------

## **å®Œæ•´ç¤ºä¾‹**

```
ruby


å¤åˆ¶ç¼–è¾‘
def to_binary_string(bytes)
  bytes.unpack("B*").first.scan(/.{8}/).join(" ")
end

num = 1024
big_endian = [num].pack("N")
little_endian = [num].pack("V")

puts "Big-endian (N):  #{to_binary_string(big_endian)}"
puts "Little-endian (V): #{to_binary_string(little_endian)}"
```

### **è¾“å‡º**

```
scss


å¤åˆ¶ç¼–è¾‘
Big-endian (N):   00000000 00000000 00000100 00000000
Little-endian (V): 00000000 00000100 00000000 00000000
```

------

## **åº”ç”¨ï¼šTCP å‘é€ 4 å­—èŠ‚é•¿åº¦å¤´**

```
ruby


å¤åˆ¶ç¼–è¾‘
message = "Hello"
length = message.bytesize
packet = [length].pack("N") + message

puts "Packet in Binary: #{to_binary_string(packet[0, 4])} | #{message}"
```

### **è¾“å‡º**

```
sql


å¤åˆ¶ç¼–è¾‘
Packet in Binary: 00000000 00000000 00000000 00000101 | Hello
```

- `00000000 00000000 00000000 00000101` â†’ 5ï¼ˆHello çš„å­—èŠ‚é•¿åº¦ï¼‰

------

è¿™æ ·ï¼Œä½ å¯ä»¥**ç›´è§‚åœ°çœ‹åˆ° `pack` å¦‚ä½•å°†æ•°æ®è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼**ï¼Œå¹¶ç”¨äº**ç½‘ç»œä¼ è¾“**ğŸš€ã€‚

##### æ‚¨è¯´ï¼š

user = {  name: 'guxiaobia'  message: 'hello world' }



###### ChatGPT è¯´ï¼š

ä½ çš„ä»£ç æœ‰ä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼Œ**`name` å’Œ `message` ä¹‹é—´ç¼ºå°‘é€—å·**ï¼Œåº”è¯¥å†™æˆï¼š

```
ruby


å¤åˆ¶ç¼–è¾‘
user = {
  name: 'guxiaobia',
  message: 'hello world'
}

puts user[:name]    # è¾“å‡º "guxiaobia"
puts user[:message] # è¾“å‡º "hello world"
```

------

## **Ruby å“ˆå¸Œï¼ˆHashï¼‰è¯´æ˜**

åœ¨ Ruby ä¸­ï¼Œå“ˆå¸Œï¼ˆHashï¼‰ç±»ä¼¼äº Python çš„å­—å…¸ï¼ˆdictï¼‰ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼š

- `user[:name]` è®¿é—®é”® `:name` å¯¹åº”çš„å€¼
- `user[:message]` è®¿é—®é”® `:message` å¯¹åº”çš„å€¼

### **å…¶ä»–å†™æ³•**

1. **ä½¿ç”¨ `=>` æ—§è¯­æ³•**

   ```
   ruby
   
   
   å¤åˆ¶ç¼–è¾‘
   user = {
     :name => 'guxiaobia',
     :message => 'hello world'
   }
   ```

2. **æ”¯æŒå­—ç¬¦ä¸²é”®**

   ```
   ruby
   
   
   å¤åˆ¶ç¼–è¾‘
   user = {
     "name" => "guxiaobia",
     "message" => "hello world"
   }
   puts user["name"] # è®¿é—®æ—¶ä¹Ÿç”¨å­—ç¬¦ä¸²é”®
   ```

------

ä½ æ˜¯æƒ³é—®ä»€ä¹ˆé—®é¢˜ï¼Ÿæ˜¯ Ruby è¯­æ³•ï¼Œè¿˜æ˜¯æƒ³è½¬æ¢ä¸º JSON ç­‰å…¶ä»–æ ¼å¼ï¼ŸğŸ˜ƒ

##### æ‚¨è¯´ï¼š

å¦‚ä½•æŠŠä¸€ä¸ªhash pack



###### ChatGPT è¯´ï¼š

åœ¨ Ruby ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `pack` æ–¹æ³•å°†å“ˆå¸Œï¼ˆ`Hash`ï¼‰è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œä½†ç”±äº `pack` ä¸»è¦ç”¨äºæ•°ç»„ï¼ˆ`Array`ï¼‰ï¼Œä½ éœ€è¦å…ˆå°†å“ˆå¸Œè½¬æ¢ä¸ºæ•°ç»„æˆ–å­—ç¬¦ä¸²ï¼Œå†è¿›è¡Œ `pack`ã€‚

------

## **1ï¸âƒ£ æ–¹æ³•ä¸€ï¼šè½¬æ¢ä¸º JSON å† Pack**

æœ€å¸¸è§çš„æ–¹æ³•æ˜¯ **å…ˆè½¬æ¢ä¸º JSONï¼Œå†æ‰“åŒ…**ï¼š

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'json'

user = { name: 'guxiaobia', message: 'hello world' }

# è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
json_string = user.to_json

# è®¡ç®—é•¿åº¦å¹¶ pack
packed_data = [json_string.bytesize].pack("N") + json_string

puts "Packed binary: #{packed_data.unpack("H*")}" # ä»¥åå…­è¿›åˆ¶å½¢å¼å±•ç¤º
```

### **è§£åŒ…ï¼ˆUnpackï¼‰**

```
ruby


å¤åˆ¶ç¼–è¾‘
header = packed_data[0, 4] # å–å‰ 4 ä¸ªå­—èŠ‚ (é•¿åº¦)
body = packed_data[4..]    # å‰©ä½™éƒ¨åˆ†æ˜¯ JSON å­—ç¬¦ä¸²

# è§£æé•¿åº¦
length = header.unpack("N")[0]
json_data = body[0, length]

# è§£æ JSON
user_parsed = JSON.parse(json_data)
puts user_parsed # => {"name"=>"guxiaobia", "message"=>"hello world"}
```

------

## **2ï¸âƒ£ æ–¹æ³•äºŒï¼šå°† Hash è½¬æ¢ä¸ºæ•°ç»„ï¼Œå† Pack**

å¦‚æœä½ çš„ Hash **é”®å€¼å›ºå®š**ï¼Œå¯ä»¥è½¬æ¢ä¸ºæ•°ç»„ï¼š

```
ruby


å¤åˆ¶ç¼–è¾‘
user = { name: 'guxiaobia', message: 'hello world' }

# å°† Hash è½¬æ¢ä¸ºæ•°ç»„ï¼ˆå­—ç¬¦ä¸²é•¿åº¦ + å­—ç¬¦ä¸²ï¼‰
data_array = [user[:name].length, user[:name], user[:message].length, user[:message]]

# ä½¿ç”¨ pack è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç 
packed_data = [data_array[0]].pack("N") + data_array[1] + [data_array[2]].pack("N") + data_array[3]

puts "Packed data: #{packed_data.inspect}"
```

### **è§£åŒ…**

```
ruby


å¤åˆ¶ç¼–è¾‘
name_length = packed_data[0, 4].unpack("N")[0]
name = packed_data[4, name_length]

message_length_offset = 4 + name_length
message_length = packed_data[message_length_offset, 4].unpack("N")[0]
message = packed_data[message_length_offset + 4, message_length]

puts "Unpacked Hash: { name: '#{name}', message: '#{message}' }"
```

------

## **3ï¸âƒ£ æ–¹æ³•ä¸‰ï¼šMarshalï¼ˆRuby ä¸“ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼‰**

Ruby ä¹Ÿå¯ä»¥ä½¿ç”¨ `Marshal` è¿›è¡Œåºåˆ—åŒ–ï¼š

```
ruby


å¤åˆ¶ç¼–è¾‘
packed_data = Marshal.dump(user)

# è§£åŒ…
unpacked_user = Marshal.load(packed_data)
puts unpacked_user # => {:name=>"guxiaobia", :message=>"hello world"}
```

> **é€‚ç”¨åœºæ™¯**ï¼š`Marshal` é€‚ç”¨äº Ruby å†…éƒ¨å­˜å‚¨ï¼Œä½†**ä¸é€‚ç”¨äºè·¨è¯­è¨€é€šä¿¡**ã€‚

------

## **æœ€ä½³å®è·µ**

- **è·¨è¯­è¨€å…¼å®¹** ğŸ† â†’ **JSON + `pack("N")`**
- **å›ºå®šæ ¼å¼** â†’ è½¬æ¢ä¸ºæ•°ç»„å† `pack`
- **Ruby å†…éƒ¨å­˜å‚¨** â†’ ä½¿ç”¨ `Marshal`

ä½ æ‰“ç®—æŠŠ `Hash` ä¼ è¾“åˆ°å“ªé‡Œï¼Ÿæ˜¯ TCP è¿˜æ˜¯æ–‡ä»¶å­˜å‚¨ï¼ŸğŸ˜ƒ

##### æ‚¨è¯´ï¼š

TCP



###### ChatGPT è¯´ï¼š

å¦‚æœä½ æ‰“ç®—é€šè¿‡ **TCP è¿æ¥** ä¼ è¾“ä¸€ä¸ªå“ˆå¸Œ (`Hash`)ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚å› ä¸º TCP ä¼ è¾“æ•°æ®é€šå¸¸éœ€è¦ä»¥ **äºŒè¿›åˆ¶æ ¼å¼** å‘é€ï¼Œè€Œå“ˆå¸Œä¸­çš„æ•°æ®ç»“æ„éœ€è¦å…ˆè½¬æ¢æˆå¯ä»¥æŒ‰å­—èŠ‚æµä¼ è¾“çš„æ ¼å¼ï¼ˆå¦‚ JSONã€æ•°ç»„æˆ– `Marshal` æ ¼å¼ï¼‰ã€‚ä»¥ä¸‹æ˜¯å°†å“ˆå¸Œé€šè¿‡ TCP å‘é€çš„ç¤ºä¾‹ã€‚

------

## **ä½¿ç”¨ JSON å’Œ Pack è¿›è¡Œ TCP ä¼ è¾“**

### **å®¢æˆ·ç«¯ï¼šå‘é€å“ˆå¸Œ**

1. å°†å“ˆå¸Œè½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ã€‚
2. è·å–å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦ï¼Œå¹¶ä½¿ç”¨ `pack` æ‰“åŒ…ã€‚
3. å‘é€å­—èŠ‚æµã€‚

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'json'

# éœ€è¦å‘é€çš„å“ˆå¸Œæ•°æ®
user = { name: 'guxiaobia', message: 'hello world' }

# å°†å“ˆå¸Œè½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
json_string = user.to_json

# è®¡ç®— JSON å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦å¹¶ç”¨ 4 å­—èŠ‚æ‰“åŒ…ï¼ˆå¤§ç«¯åºï¼‰
packed_data = [json_string.bytesize].pack("N") + json_string

# è¿æ¥åˆ° TCP æœåŠ¡å™¨å¹¶å‘é€æ•°æ®
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packed_data)
socket.close
```

### **æœåŠ¡å™¨ï¼šæ¥æ”¶å¹¶è§£æå“ˆå¸Œ**

1. è¯»å– 4 å­—èŠ‚æ•°æ®ï¼ˆæ•°æ®é•¿åº¦ï¼‰ã€‚
2. è¯»å–å®é™…æ•°æ®åŒ…ï¼Œè§£å¯†æˆ–è§£åŒ…ã€‚
3. è§£æ JSON å­—ç¬¦ä¸²ä¸ºå“ˆå¸Œã€‚

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'json'

# åˆ›å»º TCP æœåŠ¡å™¨
server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å–å‰ 4 å­—èŠ‚ï¼ˆè¡¨ç¤ºæ•°æ®åŒ…é•¿åº¦ï¼‰
  header = client.read(4)
  data_length = header.unpack("N")[0]

  # æ ¹æ®æ•°æ®åŒ…é•¿åº¦è¯»å–å‰©ä½™çš„æ•°æ®
  json_data = client.read(data_length)

  # å°† JSON å­—ç¬¦ä¸²è§£æä¸ºå“ˆå¸Œ
  user_data = JSON.parse(json_data)

  # è¾“å‡ºè§£æåçš„å“ˆå¸Œ
  puts "Received hash: #{user_data}"

  client.close
end
```

### **è¿è¡Œæ–¹æ³•**

1. å¯åŠ¨æœåŠ¡å™¨ï¼ˆåœ¨ä¸€ä¸ªç»ˆç«¯çª—å£ï¼‰ï¼š

   ```
   sh
   
   
   å¤åˆ¶ç¼–è¾‘
   ruby server.rb
   ```

2. å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼‰ï¼š

   ```
   sh
   
   
   å¤åˆ¶ç¼–è¾‘
   ruby client.rb
   ```

### **ç¤ºä¾‹è¾“å‡º**

- æœåŠ¡å™¨ç«¯ï¼š

  ```
  pgsql
  
  
  å¤åˆ¶ç¼–è¾‘
  Server is running on port 1234...
  Received hash: {"name"=>"guxiaobia", "message"=>"hello world"}
  ```

- å®¢æˆ·ç«¯ç«¯ï¼š

  ```
  å¤åˆ¶ç¼–è¾‘
  æ•°æ®åŒ…å‘é€æˆåŠŸ
  ```

------

## **ä½¿ç”¨ `Marshal` è¿›è¡Œ TCP ä¼ è¾“**

å¦‚æœåªåœ¨ Ruby ç¯å¢ƒå†…ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `Marshal` æ¥åºåˆ—åŒ–å“ˆå¸Œï¼Œè¿™ç§æ–¹å¼é€šå¸¸æ›´ç´§å‡‘ï¼ˆä½†ä¸å¯è·¨è¯­è¨€ä½¿ç”¨ï¼‰ï¼š

### **å®¢æˆ·ç«¯ï¼šå‘é€å“ˆå¸Œ**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'marshal'

user = { name: 'guxiaobia', message: 'hello world' }

# ä½¿ç”¨ Marshal åºåˆ—åŒ–å“ˆå¸Œ
packed_data = Marshal.dump(user)

# å‘é€æ•°æ®é•¿åº¦ï¼ˆ4å­—èŠ‚ï¼‰+ æ•°æ®åŒ…
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write([packed_data.bytesize].pack("N") + packed_data)
socket.close
```

### **æœåŠ¡å™¨ï¼šæ¥æ”¶å¹¶è§£æå“ˆå¸Œ**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'marshal'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å–æ•°æ®åŒ…å¤´éƒ¨ 4 å­—èŠ‚ï¼Œè·å–æ•°æ®é•¿åº¦
  header = client.read(4)
  data_length = header.unpack("N")[0]

  # è¯»å–æ•°æ®åŒ…å†…å®¹
  packed_data = client.read(data_length)

  # ä½¿ç”¨ Marshal è§£åŒ…
  user_data = Marshal.load(packed_data)

  # è¾“å‡ºè§£åŒ…åçš„å“ˆå¸Œ
  puts "Received hash: #{user_data}"

  client.close
end
```

### **æ€»ç»“**

- **JSON** é€‚ç”¨äºè·¨å¹³å°/è·¨è¯­è¨€çš„æ•°æ®äº¤æ¢ï¼Œé€šå¸¸è¾ƒä¸ºé€šç”¨ã€‚
- **Marshal** æ›´é€‚ç”¨äº Ruby å†…éƒ¨ä¼ è¾“ï¼Œé€šå¸¸æ›´åŠ é«˜æ•ˆã€‚

ä½ å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥ä¼ è¾“å“ˆå¸Œã€‚å¦‚æœä½ éœ€è¦åŠ å¯†æ•°æ®ä¼ è¾“ï¼ˆä¾‹å¦‚ HTTPSï¼‰æˆ–è¿›è¡Œæ•°æ®å‹ç¼©ï¼Œå¯ä»¥å†æ·»åŠ è¿™äº›åŠŸèƒ½ã€‚

##### æ‚¨è¯´ï¼š

TCPæ•°æ®é€šä¿¡ ç»™æˆ‘å‡ ä¸ªå¸¸è§çš„åè®®è®¾è®¡æ¡ˆä¾‹



###### ChatGPT è¯´ï¼š

åœ¨ **TCP æ•°æ®é€šä¿¡** ä¸­ï¼Œåè®®è®¾è®¡æ˜¯å†³å®šå¦‚ä½•ç»„ç»‡å’Œä¼ è¾“æ•°æ®çš„å…³é”®éƒ¨åˆ†ã€‚ä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚å¯èƒ½ä¼šæœ‰ä¸åŒçš„åè®®è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ **TCP åè®®è®¾è®¡æ¡ˆä¾‹**ï¼Œå®ƒä»¬æ¶µç›–äº†ä»ç®€å•çš„æ¶ˆæ¯ä¼ è¾“åˆ°å¤æ‚çš„æ•°æ®æµæ§åˆ¶å’ŒåŠ å¯†æ–¹æ¡ˆã€‚

### 1. **ç®€å•çš„é•¿åº¦+æ•°æ®åè®®ï¼ˆLength + Data Protocolï¼‰**

è¿™ç§åè®®è®¾è®¡æœ€ä¸ºåŸºç¡€ï¼Œå¸¸ç”¨äºé€šä¿¡ä¸­ï¼Œå½“æ¶ˆæ¯é•¿åº¦ä¸ç¡®å®šæ—¶ï¼Œå‘é€æ–¹å…ˆå‘é€æ¶ˆæ¯çš„é•¿åº¦ï¼ˆé€šå¸¸ä¸º4å­—èŠ‚çš„æ•´æ•°ï¼‰ï¼Œç„¶åå‘é€æ¶ˆæ¯çš„å®é™…å†…å®¹ã€‚

#### **è®¾è®¡æ€è·¯**ï¼š

1. å®¢æˆ·ç«¯é¦–å…ˆå‘é€ä¸€ä¸ª 4 å­—èŠ‚çš„æ•´æ•°ï¼Œè¡¨ç¤ºæ•°æ®åŒ…çš„é•¿åº¦ã€‚
2. æœåŠ¡å™¨æ¥æ”¶åˆ°é•¿åº¦åï¼Œæ ¹æ®è¯¥é•¿åº¦è¯»å–å®é™…æ•°æ®ã€‚

#### **æ¡ˆä¾‹ï¼š**

##### **å®¢æˆ·ç«¯**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

message = "Hello, world!"
# å°†æ¶ˆæ¯é•¿åº¦å’Œæ¶ˆæ¯å†…å®¹æ‰“åŒ…
packet = [message.bytesize].pack("N") + message

# è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘é€æ•°æ®
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packet)
socket.close
```

##### **æœåŠ¡å™¨**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å– 4 å­—èŠ‚ï¼ˆæ•°æ®åŒ…é•¿åº¦ï¼‰
  header = client.read(4)
  data_length = header.unpack("N")[0]

  # è¯»å–å‰©ä½™æ•°æ®
  data = client.read(data_length)

  puts "Received data: #{data}"

  client.close
end
```

#### **ä¼˜ç‚¹**ï¼š

- ç®€å•æ˜“ç”¨ã€‚
- å¯ä»¥åŠ¨æ€å¤„ç†æ¶ˆæ¯å¤§å°ã€‚

#### **ç¼ºç‚¹**ï¼š

- ä¸æ”¯æŒæ¶ˆæ¯çš„åˆ†ç‰‡å’Œé‡ç»„ï¼Œå¿…é¡»ä¿è¯ä¸€æ¬¡è¯»å–å®Œæ•´çš„æ•°æ®ã€‚

------

### 2. **åŸºäºæ¶ˆæ¯å¤´çš„åè®®ï¼ˆHeader-based Protocolï¼‰**

è¿™ç§è®¾è®¡ä¼šåœ¨æ¯ä¸ªæ•°æ®åŒ…å‰åŠ ä¸Šä¸€ä¸ªå›ºå®šé•¿åº¦çš„**æ¶ˆæ¯å¤´**ï¼Œç”¨äºæè¿°æ•°æ®åŒ…çš„ç‰¹å¾ï¼Œä¾‹å¦‚ç±»å‹ã€é•¿åº¦ã€æ ¡éªŒå’Œç­‰ã€‚

#### **è®¾è®¡æ€è·¯**ï¼š

1. æ¯ä¸ªæ•°æ®åŒ…æœ‰ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å¤´éƒ¨ï¼Œé€šå¸¸åŒ…å«ï¼šåŒ…çš„ç±»å‹ã€åŒ…ä½“çš„é•¿åº¦ã€æ ¡éªŒç ç­‰ã€‚
2. å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ ¹æ®å¤´éƒ¨ä¿¡æ¯è§£ææ•°æ®ã€‚

#### **æ¡ˆä¾‹ï¼š**

##### **æ¶ˆæ¯å¤´ç»“æ„**

```
lua


å¤åˆ¶ç¼–è¾‘
| å­—æ®µå     | é•¿åº¦ | æè¿°               |
|------------|------|--------------------|
| type       | 1B   | æ•°æ®åŒ…ç±»å‹ï¼ˆä¾‹å¦‚è¯·æ±‚ã€å“åº”ç­‰ï¼‰ |
| length     | 4B   | æ•°æ®åŒ…çš„é•¿åº¦ï¼ˆä¸åŒ…æ‹¬å¤´éƒ¨ï¼‰     |
| checksum   | 4B   | æ ¡éªŒå’Œï¼ˆå¯é€‰ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼‰ |
```

##### **å®¢æˆ·ç«¯**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'

# æ•°æ®åŒ…
type = 1  # æ•°æ®åŒ…ç±»å‹
message = "Hello, world!"
data_length = message.bytesize
checksum = Digest::SHA256.hexdigest(message)[0, 4]  # ç®€å•çš„æ ¡éªŒå’Œ

# æ„å»ºæ¶ˆæ¯å¤´
header = [type].pack("C") + [data_length].pack("N") + checksum
packet = header + message

# å‘é€æ•°æ®
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packet)
socket.close
```

##### **æœåŠ¡å™¨**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å– 9 å­—èŠ‚çš„æ¶ˆæ¯å¤´ï¼ˆ1 å­—èŠ‚ç±»å‹ï¼Œ4 å­—èŠ‚é•¿åº¦ï¼Œ4 å­—èŠ‚æ ¡éªŒå’Œï¼‰
  header = client.read(9)
  type, data_length, checksum = header.unpack("Ca4a4")

  # è¯»å–æ•°æ®
  data = client.read(data_length)

  # æ ¡éªŒ
  calculated_checksum = Digest::SHA256.hexdigest(data)[0, 4]
  if checksum == calculated_checksum
    puts "Received valid data: #{data}"
  else
    puts "Checksum mismatch, data corrupted!"
  end

  client.close
end
```

#### **ä¼˜ç‚¹**ï¼š

- å¯ä»¥æä¾›æ›´å¤æ‚çš„æ§åˆ¶ä¿¡æ¯ï¼Œå¦‚æ¶ˆæ¯ç±»å‹ã€æ ¡éªŒç­‰ã€‚
- æé«˜äº†æ•°æ®çš„å®Œæ•´æ€§éªŒè¯ï¼ˆé€šè¿‡æ ¡éªŒå’Œï¼‰ã€‚

#### **ç¼ºç‚¹**ï¼š

- åè®®è®¾è®¡è¾ƒä¸ºå¤æ‚ã€‚
- å¢åŠ äº†æ•°æ®åŒ…çš„å¤§å°ï¼ˆå¤´éƒ¨ä¿¡æ¯ï¼‰ã€‚

------

### 3. **åŸºäºè¯·æ±‚-å“åº”æ¨¡å¼çš„åè®®ï¼ˆRequest-Response Protocolï¼‰**

åœ¨è¿™ç§åè®®ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶å“åº”ç»“æœã€‚è¿™ç§æ¨¡å¼éå¸¸é€‚ç”¨äº HTTP åè®®ä»¥åŠå…¶ä»–éœ€è¦è¯·æ±‚ä¸å“åº”çš„é€šä¿¡åè®®ã€‚

#### **è®¾è®¡æ€è·¯**ï¼š

1. å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ•°æ®ã€‚
2. æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶å‘é€å“åº”æ•°æ®ã€‚

#### **æ¡ˆä¾‹ï¼š**

##### **å®¢æˆ·ç«¯**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

request = "GET /hello"
packet = [request.bytesize].pack("N") + request

socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packet)

# æ¥æ”¶å“åº”
response = socket.read(1024)
puts "Server response: #{response}"

socket.close
```

##### **æœåŠ¡å™¨**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å–è¯·æ±‚åŒ…å¤´
  header = client.read(4)
  request_length = header.unpack("N")[0]

  # è¯»å–è¯·æ±‚æ•°æ®
  request = client.read(request_length)
  puts "Received request: #{request}"

  # å¤„ç†è¯·æ±‚å¹¶å‘é€å“åº”
  response = "Hello from server!"
  client.write([response.bytesize].pack("N") + response)

  client.close
end
```

#### **ä¼˜ç‚¹**ï¼š

- æ˜“äºç†è§£å’Œå®ç°ï¼Œç¬¦åˆè¯·æ±‚-å“åº”æ¨¡å‹ã€‚
- å¯ä»¥çµæ´»æ‰©å±•å“åº”ç±»å‹ï¼ˆä¾‹å¦‚ JSONã€XML ç­‰ï¼‰ã€‚

#### **ç¼ºç‚¹**ï¼š

- æ¯æ¬¡éƒ½éœ€è¦å‘é€è¯·æ±‚å¹¶ç­‰å¾…å“åº”ï¼Œæ•ˆç‡è¾ƒä½ï¼ˆå°¤å…¶æ˜¯é•¿è¿æ¥åœºæ™¯ä¸‹ï¼‰ã€‚

------

### 4. **åŸºäºæµçš„åè®®ï¼ˆStream-based Protocolï¼‰**

åœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼Œæ•°æ®è¢«è§†ä¸ºä¸€è¿ç»­çš„æµï¼Œé€šå¸¸ç”¨åœ¨éœ€è¦å®æ—¶ä¼ è¾“å¤§é‡æ•°æ®çš„åœºæ™¯ï¼ˆä¾‹å¦‚è§†é¢‘æµæˆ–æ–‡ä»¶ä¼ è¾“ï¼‰ã€‚TCP æ˜¯æµåè®®ï¼Œæ‰€ä»¥è¿™é‡Œçš„æ•°æ®ä¼ è¾“æ²¡æœ‰æ˜ç¡®çš„æ¶ˆæ¯è¾¹ç•Œï¼Œæ•°æ®æµéœ€è¦è¿›è¡Œæ‹†åˆ†å’Œè§£æã€‚

#### **è®¾è®¡æ€è·¯**ï¼š

1. å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¿æŒé•¿è¿æ¥ï¼ŒæŒç»­ä¼ è¾“æ•°æ®ã€‚
2. æ•°æ®ä¼ è¾“æ²¡æœ‰æ˜æ˜¾çš„åˆ†ç•Œç‚¹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦åŸºäºæŸäº›è§„åˆ™ï¼ˆä¾‹å¦‚å›ºå®šé•¿åº¦çš„å—ï¼‰æ¥è§£ææ•°æ®æµã€‚

#### **æ¡ˆä¾‹ï¼š**

##### **å®¢æˆ·ç«¯**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

file = File.open("large_file.txt", "rb")
socket = TCPSocket.new('127.0.0.1', 1234)

# é€å—è¯»å–æ–‡ä»¶å¹¶å‘é€
while chunk = file.read(1024)  # æ¯æ¬¡è¯»å– 1024 å­—èŠ‚
  socket.write(chunk)
end

file.close
socket.close
```

##### **æœåŠ¡å™¨**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept
  File.open("received_file.txt", "wb") do |file|
    # æŒç»­æ¥æ”¶æ•°æ®å¹¶å†™å…¥æ–‡ä»¶
    while chunk = client.read(1024)
      file.write(chunk)
    end
  end
  client.close
end
```

#### **ä¼˜ç‚¹**ï¼š

- é€‚ç”¨äºå®æ—¶ã€å¤§é‡æ•°æ®ä¼ è¾“ï¼ˆä¾‹å¦‚æ–‡ä»¶ä¼ è¾“ï¼‰ã€‚
- æ— éœ€çŸ¥é“æ•°æ®çš„ç¡®åˆ‡è¾¹ç•Œï¼Œå¯ä»¥æŒç»­ä¼ è¾“ã€‚

#### **ç¼ºç‚¹**ï¼š

- éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ­¥å¤„ç†æµã€‚
- éœ€è¦åœ¨åº”ç”¨å±‚ç»´æŠ¤ä¸€äº›åè®®è§„åˆ™ï¼ˆä¾‹å¦‚æ•°æ®å—çš„è¾¹ç•Œï¼‰ã€‚

------

### æ€»ç»“

ä»¥ä¸Šå‡ ç§ TCP æ•°æ®é€šä¿¡åè®®è®¾è®¡æ¡ˆä¾‹ï¼Œæ¶µç›–äº†ä»ç®€å•çš„**é•¿åº¦+æ•°æ®åè®®**åˆ°å¤æ‚çš„**è¯·æ±‚-å“åº”æ¨¡å¼**ï¼Œä»¥åŠ**åŸºäºæµçš„åè®®**ã€‚è¿™äº›åè®®å¯ä»¥æ ¹æ®å®é™…çš„éœ€æ±‚ï¼ˆå¦‚æ¶ˆæ¯å¤§å°ã€æ•°æ®å®Œæ•´æ€§ã€å®æ—¶æ€§ç­‰ï¼‰è¿›è¡Œé€‰æ‹©ã€‚

##### æ‚¨è¯´ï¼š

æˆ‘å¯¹åŸºäºæ¶ˆæ¯å¤´çš„åè®®æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¤šä¸€ç‚¹æ¶ˆæ¯å¤´ç»“æ„æ¡ˆä¾‹



###### ChatGPT è¯´ï¼š

åŸºäº **æ¶ˆæ¯å¤´** çš„åè®®è®¾è®¡éå¸¸çµæ´»ï¼Œå®ƒå…è®¸ä½ åœ¨æ•°æ®åŒ…ä¸­åµŒå…¥æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚æ•°æ®ç±»å‹ã€é•¿åº¦ã€æ ¡éªŒå’Œç­‰ï¼‰ï¼Œä»è€Œå¯¹æ•°æ®è¿›è¡Œæœ‰æ•ˆçš„ç»„ç»‡å’Œè§£æã€‚æ¶ˆæ¯å¤´ç»“æ„é€šå¸¸ç”¨äºå¤æ‚çš„åº”ç”¨ä¸­ï¼Œå¦‚æ–‡ä»¶ä¼ è¾“ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ã€ç½‘ç»œåè®®ç­‰ã€‚

### **æ¶ˆæ¯å¤´ç»“æ„è®¾è®¡æ¡ˆä¾‹**

1. å¸¸è§æ¶ˆæ¯å¤´ç»“æ„

   ï¼š

   - **ç±»å‹**ï¼šæŒ‡å®šæ•°æ®åŒ…çš„ç±»å‹ï¼Œä¾‹å¦‚è¯·æ±‚ã€å“åº”ã€é”™è¯¯ç­‰ã€‚
   - **é•¿åº¦**ï¼šæŒ‡å®šæ•°æ®åŒ…çš„æœ‰æ•ˆæ•°æ®é•¿åº¦ï¼Œé€šå¸¸ä¸º 4 å­—èŠ‚æ•´æ•°ã€‚
   - **æ ¡éªŒå’Œ**ï¼šç”¨äºæ ¡éªŒæ•°æ®åŒ…çš„å®Œæ•´æ€§ï¼Œé€šå¸¸æ˜¯å“ˆå¸Œå€¼ã€‚
   - **æ ‡è¯†ç¬¦**ï¼šä¾‹å¦‚æ¶ˆæ¯ IDã€ä¼šè¯ IDï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æ•°æ®æµã€‚

### **1. åŸºç¡€æ¶ˆæ¯å¤´è®¾è®¡**

å‡è®¾æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåŒ…å« **ç±»å‹ã€é•¿åº¦ã€æ ¡éªŒå’Œ** çš„æ¶ˆæ¯å¤´ç»“æ„ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```
lua


å¤åˆ¶ç¼–è¾‘
| å­—æ®µåç§°    | é•¿åº¦ | æè¿°                      |
|-------------|------|---------------------------|
| type        | 1B   | æ•°æ®åŒ…ç±»å‹ï¼ˆä¾‹å¦‚è¯·æ±‚ã€å“åº”ç­‰ï¼‰ |
| length      | 4B   | æ•°æ®åŒ…çš„æœ‰æ•ˆæ•°æ®é•¿åº¦ï¼ˆä¸åŒ…æ‹¬å¤´éƒ¨ï¼‰ |
| checksum    | 4B   | æ•°æ®åŒ…æ ¡éªŒå’Œ                |
```

- **type**ï¼š1 å­—èŠ‚ï¼Œè¡¨ç¤ºæ¶ˆæ¯ç±»å‹ï¼Œå¦‚è¯·æ±‚ã€å“åº”ç­‰ã€‚
- **length**ï¼š4 å­—èŠ‚ï¼Œè¡¨ç¤ºæœ‰æ•ˆæ•°æ®çš„é•¿åº¦ã€‚
- **checksum**ï¼š4 å­—èŠ‚ï¼Œæ ¡éªŒå’Œï¼Œé€šå¸¸ç”¨äºæ•°æ®éªŒè¯ã€‚

#### **å®¢æˆ·ç«¯å‘é€æ•°æ®ç¤ºä¾‹**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'

# æ¨¡æ‹Ÿæ¶ˆæ¯
type = 1  # å‡è®¾ 1 ä¸ºè¯·æ±‚
message = "Hello, world!"
data_length = message.bytesize
checksum = Digest::SHA256.hexdigest(message)[0, 4]  # ç®€å•çš„æ ¡éªŒå’Œ

# æ„å»ºæ¶ˆæ¯å¤´ï¼štype + length + checksum
header = [type].pack("C") + [data_length].pack("N") + checksum
packet = header + message

# è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘é€æ•°æ®
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packet)
socket.close
```

#### **æœåŠ¡å™¨æ¥æ”¶å¹¶è§£ææ•°æ®ç¤ºä¾‹**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å–æ¶ˆæ¯å¤´ï¼š1 å­—èŠ‚ç±»å‹ï¼Œ4 å­—èŠ‚é•¿åº¦ï¼Œ4 å­—èŠ‚æ ¡éªŒå’Œ
  header = client.read(9)  # æ€»å…± 9 å­—èŠ‚
  type, data_length, checksum = header.unpack("Ca4a4")

  # è¯»å–æœ‰æ•ˆæ•°æ®
  data = client.read(data_length)

  # æ ¡éªŒæ•°æ®
  calculated_checksum = Digest::SHA256.hexdigest(data)[0, 4]
  if checksum == calculated_checksum
    puts "Received valid data: #{data}"
  else
    puts "Checksum mismatch, data corrupted!"
  end

  client.close
end
```

#### **è§£æè¿‡ç¨‹**

1. **å®¢æˆ·ç«¯**ï¼šæ„å»ºä¸€ä¸ªæ•°æ®åŒ…ï¼ŒåŒ…å¤´åŒ…å«ç±»å‹ï¼ˆ1 å­—èŠ‚ï¼‰ã€æ•°æ®é•¿åº¦ï¼ˆ4 å­—èŠ‚ï¼‰ã€æ ¡éªŒå’Œï¼ˆ4 å­—èŠ‚ï¼‰ã€‚ç„¶åå°†æœ‰æ•ˆæ•°æ®é™„åŠ åœ¨åŒ…å¤´åé¢ã€‚
2. **æœåŠ¡å™¨**ï¼šé¦–å…ˆè¯»å–æ¶ˆæ¯å¤´ï¼Œç„¶åæ ¹æ®å¤´éƒ¨çš„é•¿åº¦å­—æ®µè¯»å–æ•°æ®ã€‚æœ€åé€šè¿‡æ ¡éªŒå’ŒéªŒè¯æ•°æ®æ˜¯å¦å®Œæ•´ã€‚

------

### **2. å¢å¼ºå‹æ¶ˆæ¯å¤´è®¾è®¡ï¼ˆåŒ…å«æ›´å¤šå­—æ®µï¼‰**

å¦‚æœä½ æƒ³æ‰©å±•åŠŸèƒ½ï¼Œå¢åŠ æ›´å¤šçš„æ§åˆ¶ä¿¡æ¯ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹çš„ **å¢å¼ºå‹æ¶ˆæ¯å¤´è®¾è®¡**ï¼ŒåŒ…æ‹¬æ¶ˆæ¯ IDã€æ—¶é—´æˆ³ã€ä¼˜å…ˆçº§ç­‰ã€‚

```
pgsql


å¤åˆ¶ç¼–è¾‘
| å­—æ®µåç§°     | é•¿åº¦  | æè¿°                                |
|--------------|-------|-------------------------------------|
| type         | 1B    | æ•°æ®åŒ…ç±»å‹ï¼ˆä¾‹å¦‚è¯·æ±‚ã€å“åº”ç­‰ï¼‰      |
| length       | 4B    | æ•°æ®åŒ…çš„æœ‰æ•ˆæ•°æ®é•¿åº¦ï¼ˆä¸åŒ…æ‹¬å¤´éƒ¨ï¼‰  |
| checksum     | 4B    | æ•°æ®åŒ…æ ¡éªŒå’Œ                        |
| message_id   | 4B    | æ¶ˆæ¯ IDï¼Œå”¯ä¸€æ ‡è¯†æ¯ä¸ªè¯·æ±‚/å“åº”      |
| timestamp    | 4B    | å‘é€æ—¶é—´æˆ³                          |
| priority     | 1B    | æ¶ˆæ¯ä¼˜å…ˆçº§ï¼ˆä¾‹å¦‚ 1 è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼‰    |
```

#### **å¢å¼ºå‹åè®®è®¾è®¡åº”ç”¨**

##### **å®¢æˆ·ç«¯å‘é€æ•°æ®**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'
require 'time'

# æ¨¡æ‹Ÿæ¶ˆæ¯
type = 1  # å‡è®¾ 1 ä¸ºè¯·æ±‚
message = "Hello, world!"
data_length = message.bytesize
checksum = Digest::SHA256.hexdigest(message)[0, 4]  # æ ¡éªŒå’Œ
message_id = rand(1000..9999)  # éšæœºç”Ÿæˆä¸€ä¸ªæ¶ˆæ¯ ID
timestamp = Time.now.to_i  # è·å–å½“å‰æ—¶é—´æˆ³
priority = 1  # å‡è®¾é«˜ä¼˜å…ˆçº§

# æ„å»ºæ¶ˆæ¯å¤´ï¼štype + length + checksum + message_id + timestamp + priority
header = [
  type,
  data_length,
  checksum,
  message_id,
  timestamp,
  priority
].pack("Ca4a4NNCa1")
packet = header + message

# è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘é€æ•°æ®
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packet)
socket.close
```

##### **æœåŠ¡å™¨æ¥æ”¶å¹¶è§£ææ•°æ®**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'

server = TCPServer.new(1234)
puts "Server is running on port 1234..."

loop do
  client = server.accept

  # è¯»å–æ¶ˆæ¯å¤´ï¼š1 å­—èŠ‚ç±»å‹ï¼Œ4 å­—èŠ‚é•¿åº¦ï¼Œ4 å­—èŠ‚æ ¡éªŒå’Œï¼Œ4 å­—èŠ‚æ¶ˆæ¯ IDï¼Œ4 å­—èŠ‚æ—¶é—´æˆ³ï¼Œ1 å­—èŠ‚ä¼˜å…ˆçº§
  header = client.read(18)  # æ€»å…± 18 å­—èŠ‚
  type, data_length, checksum, message_id, timestamp, priority = header.unpack("Ca4a4NNCa1")

  # è¯»å–æœ‰æ•ˆæ•°æ®
  data = client.read(data_length)

  # æ ¡éªŒæ•°æ®
  calculated_checksum = Digest::SHA256.hexdigest(data)[0, 4]
  if checksum == calculated_checksum
    puts "Received valid data: #{data}"
    puts "Message ID: #{message_id}, Timestamp: #{timestamp}, Priority: #{priority}"
  else
    puts "Checksum mismatch, data corrupted!"
  end

  client.close
end
```

#### **è§£æè¿‡ç¨‹**

1. **å®¢æˆ·ç«¯**ï¼šæ¶ˆæ¯å¤´åŒ…æ‹¬äº†æ›´å¤šæ§åˆ¶å­—æ®µï¼Œå¦‚ `message_id`ï¼ˆæ¶ˆæ¯ IDï¼‰ã€`timestamp`ï¼ˆæ—¶é—´æˆ³ï¼‰ã€`priority`ï¼ˆä¼˜å…ˆçº§ï¼‰ã€‚è¿™äº›å­—æ®µæœ‰åŠ©äºè¿›è¡Œæ¶ˆæ¯çš„å»é‡ã€æ—¶é—´æˆ³éªŒè¯å’Œä¼˜å…ˆçº§å¤„ç†ã€‚
2. **æœåŠ¡å™¨**ï¼šæ¥æ”¶åˆ°æ•°æ®åï¼Œä¸ä»…è§£ææ¶ˆæ¯å†…å®¹ï¼Œè¿˜èƒ½è·å–æ¶ˆæ¯ IDã€æ—¶é—´æˆ³å’Œä¼˜å…ˆçº§ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨äºè®°å½•æ—¥å¿—ã€æ¶ˆæ¯æ’åºç­‰ã€‚

------

### **3. åŸºäºæ ‡è¯†ç¬¦çš„æ¶ˆæ¯å¤´ï¼ˆæ”¯æŒå¤šç§ç±»å‹çš„æ¶ˆæ¯ï¼‰**

å¦‚æœä½ çš„åº”ç”¨åœºæ™¯éœ€è¦æ”¯æŒå¤šç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆä¾‹å¦‚è¯·æ±‚ã€å“åº”ã€å¿ƒè·³ã€é”™è¯¯ç­‰ï¼‰ï¼Œä½ å¯ä»¥è®¾è®¡ä¸€ä¸ªæ›´å¤æ‚çš„æ¶ˆæ¯å¤´ï¼ŒåŒ…å« **æ ‡è¯†ç¬¦**ã€**æ¶ˆæ¯ç±»å‹** å’Œ **ç‰ˆæœ¬å·** ç­‰å­—æ®µã€‚

```
pgsql


å¤åˆ¶ç¼–è¾‘
| å­—æ®µåç§°   | é•¿åº¦  | æè¿°                           |
|------------|-------|--------------------------------|
| msg_id     | 4B    | æ¶ˆæ¯ IDï¼Œå”¯ä¸€æ ‡è¯†æ¯ä¸ªæ¶ˆæ¯       |
| version    | 2B    | åè®®ç‰ˆæœ¬å·                     |
| type       | 1B    | æ¶ˆæ¯ç±»å‹ï¼ˆè¯·æ±‚ã€å“åº”ã€é”™è¯¯ç­‰ï¼‰ |
| length     | 4B    | æ•°æ®é•¿åº¦ï¼ˆä¸åŒ…å«å¤´éƒ¨ï¼‰         |
| timestamp  | 4B    | å‘é€æ—¶é—´æˆ³                     |
```

#### **è®¾è®¡æ€è·¯**

- **msg_id**ï¼šæ ‡è¯†æ¯ä¸ªæ¶ˆæ¯ï¼Œä¾¿äºè¿½è¸ªå’Œå…³è”è¯·æ±‚/å“åº”ã€‚
- **version**ï¼šè¡¨ç¤ºåè®®ç‰ˆæœ¬ï¼Œæ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†ã€‚
- **type**ï¼šæŒ‡å®šæ¶ˆæ¯çš„ç±»å‹ï¼ˆå¦‚è¯·æ±‚ã€å“åº”ã€é”™è¯¯ï¼‰ã€‚
- **timestamp**ï¼šå‘é€çš„æ—¶é—´æˆ³ã€‚

#### **å®¢æˆ·ç«¯å‘é€æ•°æ®**

```
ruby


å¤åˆ¶ç¼–è¾‘
require 'socket'
require 'digest'
require 'time'

# æ¨¡æ‹Ÿæ¶ˆæ¯
msg_id = rand(1000..9999)  # æ¶ˆæ¯ ID
version = 1  # åè®®ç‰ˆæœ¬
type = 1  # å‡è®¾ 1 ä¸ºè¯·æ±‚
message = "Hello, world!"
data_length = message.bytesize
timestamp = Time.now.to_i  # è·å–å½“å‰æ—¶é—´æˆ³

# æ„å»ºæ¶ˆæ¯å¤´ï¼šmsg_id + version + type + length + timestamp
header = [
  msg_id,
  version,
  type,
  data_length,
  timestamp
].pack("NnCa4N")
packet = header + message

# è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘é€æ•°æ®
socket = TCPSocket.new('127.0.0.1', 1234)
socket.write(packet)
socket.close
```

------

### **æ€»ç»“**

è¿™äº›è®¾è®¡æ¡ˆä¾‹å±•ç¤ºäº†ä¸åŒçš„ **æ¶ˆæ¯å¤´ç»“æ„**ï¼Œæ¯ä¸ªç»“æ„éƒ½èƒ½æ»¡è¶³ä¸åŒçš„åº”ç”¨éœ€æ±‚ã€‚è®¾è®¡åˆç†çš„æ¶ˆæ¯å¤´ä¸ä»…èƒ½ç¡®ä¿æ•°æ®çš„æœ‰æ•ˆä¼ è¾“ï¼Œè¿˜èƒ½æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚æ ¡éªŒã€ä¼˜å…ˆçº§ã€æ¶ˆæ¯ ID ç­‰ï¼Œæ–¹ä¾¿å¤„ç†å¤æ‚çš„é€šä¿¡åœºæ™¯ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„è®¾è®¡æ–¹æ³•ã€‚